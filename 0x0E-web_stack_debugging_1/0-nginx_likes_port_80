#!/bin/bash

# Install Nginx
apt-get update
apt-get install -y nginx

# Check if Nginx is running
if systemctl is-active --quiet nginx; then
    echo "Nginx is already running."
else
    # Start Nginx if it's not running
    systemctl start nginx
fi

# Ensure Nginx is enabled to start on boot
systemctl enable nginx

# Get the active IPv4 addresses of the server
active_ips=$(ip -o -4 addr show scope global | awk '{print $4}' | cut -d'/' -f1)

# Configure Nginx to listen on port 80 for all active IPv4 IPs
config_file="/etc/nginx/sites-available/default"
sed -i "s/listen 80;/listen 80;\n    listen 80 default_server;/" "$config_file"

# Restart Nginx to apply the configuration changes
systemctl restart nginx

# Display the active IPs and their corresponding Nginx configuration
echo "Nginx is now listening on port 80 for the following active IPv4 IPs:"
echo "$active_ips"

